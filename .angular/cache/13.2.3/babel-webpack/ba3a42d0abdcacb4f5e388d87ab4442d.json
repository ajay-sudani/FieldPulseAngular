{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { Country_Tax_Rate, getPizzaSubtotal } from '../core/utils';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../core/services/pizza.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/material/button\";\n\nfunction PizzaOrderCalculationComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵelementStart(1, \"div\", 7);\n    i0.ɵɵelement(2, \"img\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 3);\n    i0.ɵɵelementStart(4, \"p\", 9);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 10);\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \" Price : \");\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"label\");\n    i0.ɵɵtext(12, \" Count : \");\n    i0.ɵɵelementStart(13, \"span\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"label\");\n    i0.ɵɵtext(16, \" Subtotal : \");\n    i0.ɵɵelementStart(17, \"span\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const pizza_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", pizza_r1.image_url, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(pizza_r1.name);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", pizza_r1.price, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", pizza_r1.quantity, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", pizza_r1.price * (pizza_r1.quantity || 0), \"\");\n  }\n}\n\nexport let PizzaOrderCalculationComponent = /*#__PURE__*/(() => {\n  class PizzaOrderCalculationComponent {\n    constructor(pizzaService) {\n      this.pizzaService = pizzaService;\n      this.pizzaList = [];\n      this.selectedPizzeria = null;\n      this.setSelectedTabIndexEvent = new EventEmitter();\n      this.orderResponseEvent = new EventEmitter();\n      this.totalTax = 0;\n      this.usTaxRate = 0;\n      this.subTotal = 0;\n      this.orderResponse = null;\n    }\n\n    ngOnInit() {\n      this.pizzaService.getUsTaxRate().subscribe(rate => {\n        this.usTaxRate = rate.us_tax_rate;\n      });\n    }\n\n    ngOnChanges(changes) {\n      var _a, _b, _c, _d;\n\n      if (((_b = (_a = changes['selectedPizzeria']) === null || _a === void 0 ? void 0 : _a.currentValue) === null || _b === void 0 ? void 0 : _b.id) !== ((_d = (_c = changes['selectedPizzeria']) === null || _c === void 0 ? void 0 : _c.previousValue) === null || _d === void 0 ? void 0 : _d.id)) {\n        this.totalTax = 0;\n        this.subTotal = 0;\n      }\n\n      if (this.selectedPizzeria && this.pizzaList.length > 0) {\n        // calculate tax rate based on selected pizzeria and pizza type\n        const orderedPizza = this.getOrderedPizza();\n        this.totalTax = orderedPizza.reduce((total, pizza) => {\n          total += pizza.tax;\n          return total;\n        }, 0);\n        this.subTotal = getPizzaSubtotal(this.pizzaList);\n        this.orderResponse = {\n          result: {\n            pizzeria_id: this.selectedPizzeria.id,\n            pizza_items: orderedPizza,\n            subtotal: this.subTotal,\n            tax: this.totalTax,\n            total: Number((this.subTotal + this.totalTax).toFixed(2))\n          }\n        };\n      }\n    }\n    /**\n     *  Get ordered pizzas\n     * @returns ordered pizza list\n     */\n\n\n    getOrderedPizza() {\n      const list = [];\n      this.pizzaList.forEach(pizza => {\n        var _a;\n\n        const {\n          id: pizza_id,\n          price,\n          is_taxed\n        } = pizza;\n        const quantity = pizza.quantity;\n        let taxRate = 0;\n\n        if (is_taxed) {\n          const country = Country_Tax_Rate[(_a = this.selectedPizzeria) === null || _a === void 0 ? void 0 : _a.country];\n          taxRate = Number(country === Country_Tax_Rate.US ? this.usTaxRate : pizza[country]);\n        }\n\n        const subtotal = quantity * price;\n        const tax = Number((subtotal * taxRate / 100).toFixed(2));\n        list.push({\n          pizza_id,\n          quantity,\n          subtotal,\n          tax,\n          total: subtotal + tax\n        });\n      });\n      return list;\n    }\n\n    confirmOrder() {\n      this.orderResponseEvent.emit(this.orderResponse);\n      this.setSelectedTabIndexEvent.emit(3);\n    }\n\n  }\n\n  PizzaOrderCalculationComponent.ɵfac = function PizzaOrderCalculationComponent_Factory(t) {\n    return new (t || PizzaOrderCalculationComponent)(i0.ɵɵdirectiveInject(i1.PizzaService));\n  };\n\n  PizzaOrderCalculationComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PizzaOrderCalculationComponent,\n    selectors: [[\"app-pizza-order-calculation\"]],\n    inputs: {\n      pizzaList: \"pizzaList\",\n      selectedPizzeria: \"selectedPizzeria\"\n    },\n    outputs: {\n      setSelectedTabIndexEvent: \"setSelectedTabIndexEvent\",\n      orderResponseEvent: \"orderResponseEvent\"\n    },\n    features: [i0.ɵɵNgOnChangesFeature],\n    decls: 22,\n    vars: 7,\n    consts: [[1, \"order-calculation-container\"], [\"class\", \"row\", 4, \"ngFor\", \"ngForOf\"], [1, \"row\", \"final-calculation\"], [1, \"details\"], [1, \"confirm-order\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"row\"], [1, \"avatar\"], [3, \"src\"], [1, \"name\"], [1, \"price-details\"]],\n    template: function PizzaOrderCalculationComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, PizzaOrderCalculationComponent_div_1_Template, 19, 5, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"label\");\n        i0.ɵɵtext(5, \" Subtotal : \");\n        i0.ɵɵelementStart(6, \"span\");\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"label\");\n        i0.ɵɵtext(9, \" Tax : \");\n        i0.ɵɵelementStart(10, \"span\");\n        i0.ɵɵtext(11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"p\");\n        i0.ɵɵtext(13, \"----------------------------\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"label\");\n        i0.ɵɵtext(15, \" Total : \");\n        i0.ɵɵelementStart(16, \"span\");\n        i0.ɵɵtext(17);\n        i0.ɵɵpipe(18, \"number\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 4);\n        i0.ɵɵelementStart(20, \"button\", 5);\n        i0.ɵɵlistener(\"click\", function PizzaOrderCalculationComponent_Template_button_click_20_listener() {\n          return ctx.confirmOrder();\n        });\n        i0.ɵɵtext(21, \"Confirm Order\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.pizzaList);\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate1(\" \", ctx.subTotal, \" $\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", ctx.totalTax, \" $\");\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(18, 4, ctx.subTotal + ctx.totalTax, \"1.2-2\"), \" $\");\n      }\n    },\n    directives: [i2.NgForOf, i3.MatButton],\n    pipes: [i2.DecimalPipe],\n    styles: [\".order-calculation-container[_ngcontent-%COMP%]{margin:50px 10px;padding:50px;background-color:#fff;box-shadow:#999 2px 2px 10px;border-radius:5px}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;margin-bottom:25px;padding-bottom:10px;border-bottom:1px solid grey}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover}@media screen and (max-width: 479px){.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px}}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{margin-left:30px;display:flex;flex-direction:column;justify-content:center}@media screen and (max-width: 479px){.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{margin-left:20px}}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:18px}@media screen and (max-width: 479px){.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:16px}}@media screen and (max-width: 479px){.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .price-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:16px;margin-right:20px}.order-calculation-container[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:green}.order-calculation-container[_ngcontent-%COMP%]   .row.final-calculation[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{width:100%;text-align:right}.order-calculation-container[_ngcontent-%COMP%]   .row.final-calculation[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80px;display:inline-block;font-weight:700}.order-calculation-container[_ngcontent-%COMP%]   .confirm-order[_ngcontent-%COMP%]{text-align:right}\"]\n  });\n  return PizzaOrderCalculationComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}